const checkedData=new Map,elements={productList:document.getElementById("products-list"),navigation:document.getElementById("products-navigation"),notFound:document.getElementById("products-notfound"),deleteFilter:document.getElementById("delete-filter"),btnReset:document.getElementById("btn-reset"),btnApply:document.getElementById("btn-apply"),btnOpen:document.getElementById("open-filter"),btnClose:document.getElementById("btn-close-filter"),elmFilter:document.getElementById("filter__accordion"),accordionHeaders:document.querySelectorAll(".accordion__header"),tags:document.querySelector(".head-tags"),accordionBody:document.querySelector(".accordion__body"),amount:document.getElementById("amount")},toggleNotFound=e=>{elements.productList.classList.toggle("hide",e),elements.navigation.classList.toggle("hide",e),elements.notFound.classList.toggle("hide",!e),e?elements.amount.innerHTML="0 sản phẩm":checkedData.size>2?elements.amount.innerHTML="24 sản phẩm":elements.amount.innerHTML="134 sản phẩm"},initPriceSlider=()=>{const e=$("#slider-range"),t=$("#number-left"),n=$("#number-right"),l=parseInt(t.attr("min"),10)||0,s=parseInt(n.attr("max"),10)||3e7,c=new Intl.NumberFormat("vi-VN"),o=e=>0===e?"0":`${c.format(e)} đ`,a=e=>parseInt(e.replace(/[^\d]/g,""),10)||0;e.slider({range:!0,min:l,max:s,values:[a(t.val())||l,a(n.val())||s],slide:(e,l)=>{t.val(o(l.values[0])),n.val(o(l.values[1]))}}),t.val(o(e.slider("values",0))),n.val(o(e.slider("values",1))),t.on("change",(()=>{let n=a(t.val());const s=e.slider("values",1);n=Math.max(l,Math.min(n,s)),e.slider("values",0,n),t.val(o(n))})),n.on("change",(()=>{let t=a(n.val());const l=e.slider("values",0);t=Math.min(s,Math.max(t,l)),e.slider("values",1,t),n.val(o(t))}))},hideFilter=()=>{elements.elmFilter.classList.remove("show"),$("body").removeClass("noScroll")},handleFilterEvents=()=>{elements.btnOpen&&elements.elmFilter&&elements.btnOpen.addEventListener("click",(()=>{elements.elmFilter.classList.add("show"),$("body").addClass("noScroll")})),elements.btnClose&&elements.elmFilter&&(elements.btnClose.addEventListener("click",hideFilter),elements.btnReset.addEventListener("click",hideFilter),elements.btnApply.addEventListener("click",hideFilter))},toggleAccordion=(e,t)=>{const n=e.classList.contains("open");t.setAttribute("xlink:href",n?"#icon-increase":"#icon-decrease"),e.style.display=n?"none":"block",setTimeout((()=>e.classList.toggle("open",!n)),n?200:10)},closeAllAccordions=()=>{elements.accordionHeaders.forEach((e=>{const t=e.closest(".list_accordion"),n=t.querySelector(".accordion__content"),l=t.querySelector("use");n.classList.contains("open")&&toggleAccordion(n,l)}))},initAccordionEvents=()=>{elements.accordionHeaders.forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".list_accordion");toggleAccordion(t.querySelector(".accordion__content"),t.querySelector("use"))}))}))},handleCheckboxes=()=>{if(!elements.accordionBody)return;const e=elements.accordionBody.querySelectorAll('input[type="checkbox"]'),t=()=>{elements.tags.classList.toggle("has-tag",checkedData.size>0),elements.tags.innerHTML=[...checkedData].map((([e,t])=>`\n        <div class="tag" data-value="${e}">\n          ${t}\n          <button>\n            <svg>\n              <use xlink:href="#icon-close"></use>\n            </svg>\n          </button>\n        </div>\n      `)).join("")},n=()=>{elements.deleteFilter.classList.toggle("hide",0===checkedData.size)},l=()=>{checkedData.clear(),e.forEach((e=>e.checked=!1)),t(),n(),toggleNotFound(!1),closeAllAccordions()};e.forEach((e=>{const l=e.closest("label"),s=l?.querySelector("span:not([class])"),c=s?.textContent.trim()||e.value;e.addEventListener("change",(l=>{l.target.checked?checkedData.set(e.value,c):checkedData.delete(e.value),t(),n(),toggleNotFound(checkedData.size>4)}))})),elements.tags.addEventListener("click",(l=>{const s=l.target.closest(".tag");if(s){const l=s.dataset.value;checkedData.delete(l),e.forEach((e=>{e.value===l&&(e.checked=!1)})),t(),n(),toggleNotFound(checkedData.size>4)}})),elements.deleteFilter.addEventListener("click",l),elements.btnReset.addEventListener("click",l)};elements.deleteFilter.classList.add("hide"),initPriceSlider(),handleFilterEvents(),initAccordionEvents(),handleCheckboxes();